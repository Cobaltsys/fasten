# Тестовое задание для JAVA EE Developer

## Задание

Необходимо реализовать серверное приложение осуществляющее операцию

аутентификации пользователя.

Взаимодействие клиент/сервер происходит по протоколу webSocket(http://ru.wikipedia.org/wiki/WebSocket). Запросы к серверу и ответы от него передаются в формате JSON(http://ru.wikipedia.org/wiki/JSON).

Приложение должно обеспечивать следующие процессы:

— аутентификацию пользователя<br />
— приложение должно принимать запрос LOGIN_CUSTOMER проверять наличие данного пользователя в базе с указанным паролем и возвращать либо сообщение об успешно аутентификации с токеном и датой его истечения, либо сообщение об ошибке<br />
— хранение токенов пользователей<br />
— приложение должно вести базу выданных пользователям токенов.<br />
— приложение должно вести историю токенов пользователей.<br />
— приложение должно сбрасывать токен пользователя если он запрашивает повторную аутентификацию.<br />

## Описание протокола

Описание структуры исходящего сообщения:<br />
{<br />
  “type”: “TYPE_OF_MESSAGE” , // строка, тип сообщения<br />
  “sequence_id”: “09caaa73-b2b1-187e-2b24-683550a49b23”, // строка, идентификатор связанности сообщений<br />
  “data” : {} // объект, содержит данные запроса<br />
}

Описание структуры входящего сообщения:<br />
{<br />
  “type”: “TYPE_OF_MESSAGE” , // строка, тип сообщения<br />
  “sequence_id”: “09caaa73-b2b1-187e-2b24-683550a49b23”, // строка, идентификатор связанности сообщений<br />
  “data” : {} // объект, содержит данные ответа<br />
}

В случае возврата сообщения об ошибке, объект data должен содержать следующие поля:

"error_description":"Customer not found”, // поле с описанием ошибки<br />
"error_code":"customer.notFound” // поле с кодом ошибки

Запрос для успешной операции аутентификации:<br />
{<br />
  "type":"LOGIN_CUSTOMER”,<br />
  "sequence_id":"a29e4fd0-581d-e06b-c837-4f5f4be7dd18”,<br />
  "data”:{<br />
        "email":"fpi@bk.ru”,<br />
        "password":”123123"<br />
  }<br />
}

Ответ для успешной операции аутентификации:<br />
{<br />
  "type":"CUSTOMER_API_TOKEN”,<br />
  "sequence_id":"cbf187c9-8679-0359-eb3d-c3211ee51a15”,<br />
  "data”:{<br />
         "api_token":"afdd312c-3d2a-45ee-aa61-468aba3397f3”,<br />
         "api_token_expiration_date":"2015-07-15T11:14:30Z”<br />
  }<br />
}

Запрос для не успешной операции аутентификации:<br />
{<br />
  "type":"LOGIN_CUSTOMER",<br />
  "sequence_id":"715c13b3-881a-9c97-b853-10be585a9747”,<br />
  "data”:{<br />
        "email":"123@gmail.com”,<br />
        "password":”newPassword"<br />
  }<br />
}

Ответ для не успешной операции аутентификации:<br />
{<br />
  "type":"CUSTOMER_ERROR”,<br />
  "sequence_id":"715c13b3-881a-9c97-b853-10be585a9747”,<br />
  "data”:{<br />
       "error_description":"Customer not found”,<br />
       "error_code":"customer.notFound”<br />
  }<br />
}

## Необходимо самостоятельно организовать:
   
— поддержку связанности сообщений, в описании протокола средства для этого заложены<br />
— обработку ошибок;<br />
— работу с БД;<br />
— по необходимости работу с конфигурационными файлами;<br />
— по необходимости работу с WebSocket сессиями<br />
— приложение должно быть готово к работе большого числа пользователей через разные WebSocket сессии.<br />

# Решение

Решение построено на связке maven + liquibase + PostgreSQL + WildFly

database - структура базы данных PostgreSQL. Импортируется командой mvn liquibase:update -P dev<br />
web - само приложение в виде ear модуля

web-ejb - entity, dao, ejb<br />
web-main - endpoint, test webpage